Version 4
SHEET 1 1824 1076
WIRE -736 -2336 -768 -2336
WIRE -208 -2336 -256 -2336
WIRE -768 -2320 -768 -2336
WIRE -256 -2320 -256 -2336
WIRE -928 -2096 -960 -2096
WIRE -112 -2080 -144 -2080
WIRE -960 -2064 -960 -2096
WIRE -112 -2048 -112 -2080
WIRE -448 -2000 -496 -2000
WIRE -496 -1984 -496 -2000
WIRE -960 -1936 -960 -1984
WIRE -112 -1904 -112 -1968
WIRE 176 -1600 128 -1600
WIRE 464 -1600 320 -1600
WIRE -192 -1568 -272 -1568
WIRE 176 -1568 128 -1568
WIRE 352 -1568 320 -1568
WIRE 464 -1568 464 -1600
WIRE 464 -1568 416 -1568
WIRE -1680 -1552 -1840 -1552
WIRE -1472 -1552 -1536 -1552
WIRE -192 -1536 -192 -1568
WIRE -1840 -1520 -1840 -1552
WIRE -1792 -1520 -1840 -1520
WIRE -1712 -1520 -1728 -1520
WIRE -1680 -1520 -1712 -1520
WIRE -1472 -1520 -1536 -1520
WIRE -352 -1520 -352 -1568
WIRE -320 -1520 -320 -1568
WIRE -272 -1520 -272 -1568
WIRE 128 -1504 128 -1568
WIRE -1472 -1472 -1472 -1520
WIRE 352 -1392 352 -1568
WIRE 352 -1392 96 -1392
WIRE -1712 -1376 -1712 -1520
WIRE -1456 -1376 -1712 -1376
WIRE -352 -1344 -352 -1392
WIRE -352 -1344 -400 -1344
WIRE -272 -1344 -272 -1392
WIRE -224 -1344 -272 -1344
WIRE -1968 -1280 -2032 -1280
WIRE -1696 -1280 -1968 -1280
WIRE -1456 -1280 -1456 -1376
WIRE -1456 -1280 -1600 -1280
WIRE -1120 -1280 -1456 -1280
WIRE -688 -1280 -1120 -1280
WIRE -400 -1280 -400 -1344
WIRE -400 -1280 -608 -1280
WIRE -352 -1280 -400 -1280
WIRE -224 -1280 -224 -1344
WIRE -224 -1280 -272 -1280
WIRE 96 -1280 96 -1392
WIRE 96 -1280 -224 -1280
WIRE 208 -1280 96 -1280
WIRE 576 -1280 304 -1280
WIRE 768 -1280 576 -1280
WIRE 800 -1280 768 -1280
WIRE -1968 -1200 -1968 -1280
WIRE -1616 -1184 -1616 -1232
WIRE 224 -1184 224 -1232
WIRE -1968 -1072 -1968 -1136
WIRE -1616 -1072 -1616 -1104
WIRE 224 -1056 224 -1104
WIRE -528 -1040 -608 -1040
WIRE 576 -1024 576 -1280
WIRE -1840 -992 -1840 -1520
WIRE -1696 -992 -1840 -992
WIRE -1456 -992 -1456 -1280
WIRE -1456 -992 -1536 -992
WIRE 96 -976 96 -1280
WIRE 144 -976 96 -976
WIRE 464 -976 464 -1568
WIRE 464 -976 304 -976
WIRE -1120 -960 -1120 -1280
WIRE -528 -960 -528 -1040
WIRE -224 -960 -224 -1280
WIRE -608 -912 -704 -912
WIRE -1296 -880 -1344 -880
WIRE -1168 -880 -1216 -880
WIRE -400 -880 -448 -880
WIRE -272 -880 -320 -880
WIRE -1584 -864 -1584 -912
WIRE -608 -848 -656 -848
WIRE -1344 -800 -1344 -880
WIRE -1120 -736 -1120 -864
WIRE -656 -736 -656 -848
WIRE -656 -736 -1120 -736
WIRE -528 -736 -528 -800
WIRE -528 -736 -656 -736
WIRE -224 -736 -224 -864
WIRE -224 -736 -528 -736
WIRE 192 -736 192 -896
WIRE 192 -736 -224 -736
WIRE 576 -736 576 -960
WIRE 576 -736 192 -736
WIRE -1648 -720 -1648 -912
WIRE -1648 -720 -1728 -720
WIRE -1424 -720 -1504 -720
WIRE -1152 -720 -1264 -720
WIRE -1120 -720 -1120 -736
WIRE -1120 -720 -1152 -720
WIRE -2096 -704 -2256 -704
WIRE -1808 -704 -1968 -704
WIRE -1600 -688 -1728 -688
WIRE -1312 -592 -1312 -640
WIRE -1152 -592 -1152 -720
WIRE -1152 -592 -1312 -592
WIRE -1600 -576 -1600 -688
WIRE -1376 -576 -1376 -640
WIRE -1376 -576 -1600 -576
WIRE 256 -576 256 -896
WIRE 256 -576 -320 -576
WIRE 768 -512 768 -1280
WIRE 1264 -512 768 -512
WIRE -1280 -384 -1376 -384
WIRE -1072 -384 -1136 -384
WIRE 64 -368 16 -368
WIRE 240 -368 128 -368
WIRE 416 -368 320 -368
WIRE -704 -352 -704 -912
WIRE -704 -352 -896 -352
WIRE -1280 -336 -1376 -336
WIRE -976 -336 -1136 -336
WIRE 768 -336 768 -512
WIRE -320 -320 -320 -576
WIRE -320 -320 -896 -320
WIRE 416 -272 416 -368
WIRE 464 -272 416 -272
WIRE 592 -272 544 -272
WIRE 144 -208 144 -256
WIRE 416 -192 416 -272
WIRE 416 -192 176 -192
WIRE -2256 -176 -2256 -704
WIRE 16 -176 16 -368
WIRE 16 -176 -2256 -176
WIRE 112 -176 16 -176
WIRE 592 -176 592 -272
WIRE 624 -176 592 -176
WIRE 768 -176 768 -256
WIRE 768 -176 704 -176
WIRE 240 -160 176 -160
WIRE 416 -144 416 -192
WIRE 480 -144 416 -144
WIRE 592 -144 592 -176
WIRE 592 -144 544 -144
WIRE 768 -128 768 -176
WIRE 144 -96 144 -144
WIRE 240 -80 240 -160
WIRE 768 16 768 -48
WIRE -112 64 -224 64
WIRE 32 64 -48 64
WIRE 1264 80 1264 -512
WIRE 1264 80 336 80
WIRE 336 144 336 80
WIRE -224 160 -224 64
WIRE -176 160 -224 160
WIRE -64 160 -112 160
WIRE 32 160 32 64
WIRE 32 160 16 160
WIRE -80 256 -80 224
WIRE 32 272 32 160
WIRE 32 272 -48 272
WIRE 64 272 32 272
WIRE 336 272 336 224
WIRE 336 272 144 272
WIRE -1376 288 -1376 -336
WIRE -224 288 -224 160
WIRE -224 288 -1376 288
WIRE -112 288 -224 288
WIRE 32 304 -48 304
WIRE 336 304 336 272
WIRE -80 368 -80 320
WIRE 336 432 336 384
WIRE 32 448 32 304
FLAG -960 -1936 0
FLAG -112 -1904 0
FLAG -144 -2080 out
IOPIN -144 -2080 In
FLAG -768 -2240 0
FLAG -256 -2240 0
FLAG -736 -2336 control1
IOPIN -736 -2336 Out
FLAG -208 -2336 control2
IOPIN -208 -2336 Out
FLAG -496 -1904 0
FLAG -448 -2000 load
IOPIN -448 -2000 Out
FLAG -928 -2096 in
IOPIN -928 -2096 Out
FLAG 576 -736 0
FLAG -1584 -864 0
FLAG -1472 -1472 0
FLAG 128 -1504 0
FLAG -2032 -1280 in
FLAG -1472 -1552 in
FLAG 128 -1600 in
FLAG 800 -1280 out
FLAG -608 -1040 in
FLAG -1504 -720 in
FLAG -1968 -1072 0
FLAG -80 224 in
FLAG -80 368 0
FLAG 336 432 0
FLAG 144 -96 0
FLAG 144 -256 in
FLAG -1072 -384 ramp
FLAG -192 -1536 0
FLAG -320 -1568 Vs
IOPIN -320 -1568 Out
FLAG -352 -1568 in
IOPIN -352 -1568 In
FLAG -1376 -384 Vs
FLAG 240 -80 control1
FLAG 32 448 control2
FLAG 768 16 0
SYMBOL voltage -960 -2080 R0
WINDOW 0 42 54 Left 2
WINDOW 3 -129 174 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 38 72 Left 2
SYMATTR InstName Vbatt
SYMATTR Value PWL(0 12.6 {t1} 12.6 {t1+0.1m} 9.6)
SYMATTR SpiceLine Rser=0.05
SYMBOL res -128 -2064 R0
SYMATTR InstName Rload
SYMATTR Value R=v(load)
SYMBOL voltage -768 -2336 R0
WINDOW 3 -275 128 Left 2
WINDOW 0 44 59 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 -278 149 Left 2
SYMATTR Value PWL(0 {Vref1_5V} {t1} {Vref1_5V} {t1+0.1m} {Vref1_20V})
SYMATTR InstName Vcontrol1
SYMATTR SpiceLine Rser=100
SYMBOL voltage -256 -2336 R0
WINDOW 3 -229 136 Left 2
WINDOW 0 45 55 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 -229 156 Left 2
SYMATTR Value PWL(0 {Vref2_5V} {t1} {Vref2_5V} {t1+0.1m} {Vref2_20V})
SYMATTR InstName Vcontrol2
SYMATTR SpiceLine Rser=100
SYMBOL voltage -496 -2000 R0
WINDOW 3 -89 -32 Left 2
WINDOW 0 39 54 Left 2
SYMATTR Value PWL(0 2.5 {t1} 2.5 {t1+0.1m} 8.9 {t2} 8.9 {t2+1u} 6.7)
SYMATTR InstName Vload
SYMBOL nmos -1696 -1232 R270
SYMATTR InstName M1
SYMATTR Value BSC0906NS
SYMBOL nmos -1168 -960 R0
SYMATTR InstName M2
SYMATTR Value BSC0906NS
SYMBOL nmos -272 -960 R0
SYMATTR InstName M3
SYMATTR Value BSC093N04LS
SYMBOL nmos 304 -1232 M270
SYMATTR InstName M4
SYMATTR Value BSC0906NS
SYMBOL cap 560 -1024 R0
SYMATTR InstName C1
SYMATTR Value 47µ
SYMBOL ind -704 -1264 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value Hc=10 Br=0.12 Bs=0.33 A=0.000023 Lm=0.0394 Lg=1420u N=15
SYMATTR SpiceLine Rser=11.6m
SYMBOL Driver 224 -960 M270
SYMATTR InstName U1
SYMATTR SpiceLine2 Tdelay=30ns, IQ=1mA, Vuvl=8V
SYMBOL Driver -1616 -976 R270
SYMATTR InstName U2
SYMATTR SpiceLine2 Tdelay=30ns, IQ=1mA, Vuvl=8V
SYMBOL res 208 -1200 R0
SYMATTR InstName R1
SYMATTR Value 1
SYMBOL res -1632 -1200 R0
SYMATTR InstName R2
SYMATTR Value 1
SYMBOL aux_dcx 240 -1584 R0
SYMATTR InstName U3
SYMBOL cap 416 -1584 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 10µ
SYMBOL aux_dcx -1600 -1536 M0
SYMATTR InstName U4
SYMBOL cap -1728 -1536 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 10µ
SYMBOL Driver -1344 -704 R270
SYMATTR InstName U5
SYMATTR SpiceLine2 Tdelay=30ns, IQ=1mA, Vuvl=8V
SYMBOL Driver -544 -880 R0
SYMATTR InstName U6
SYMATTR SpiceLine2 Tdelay=30ns, IQ=1mA, Vuvl=8V
SYMBOL res -304 -896 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1
SYMBOL res -1200 -896 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1
SYMBOL dead_time -1776 -704 R0
SYMATTR InstName U7
SYMATTR SpiceLine Td=30ns
SYMBOL dead_time -944 -336 R0
SYMATTR InstName U8
SYMATTR SpiceLine Td=30ns
SYMBOL PWM -2032 -704 R0
SYMATTR InstName U9
SYMATTR SpiceLine VM=5V, fs=400kHz
SYMATTR SpiceLine2 Dmin=0.01, Dmax=0.99, Voffset=0
SYMBOL cap -1984 -1200 R0
SYMATTR InstName C4
SYMATTR Value 47µ
SYMBOL res 160 256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 6.4k
SYMBOL res 32 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 100k
SYMBOL cap -48 48 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 26.5p
SYMBOL cap -112 144 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 589.5p
SYMBOL Opamps\\LT1215 -80 224 M0
SYMATTR InstName U11
SYMBOL res 320 128 R0
SYMATTR InstName R7
SYMATTR Value 30k
SYMBOL res 320 288 R0
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL Opamps\\LT1215 144 -240 M0
SYMATTR InstName U12
SYMBOL res 336 -384 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 100k
SYMBOL res 560 -288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 23.4k
SYMBOL res 720 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 2767
SYMBOL cap 128 -384 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C7
SYMATTR Value 0.53n
SYMBOL cap 544 -160 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C8
SYMATTR Value 0.99n
SYMBOL CPM_modulator -1216 -368 M180
SYMATTR InstName U10
SYMATTR SpiceLine fs=400kHz, Va=0.575
SYMATTR SpiceLine2 Vcmax=1.5, Dmin=0, Dmax=0.99, Voffset=0
SYMBOL MAX4376 -304 -1456 R270
SYMATTR InstName U14
SYMBOL res -256 -1296 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 5m
SYMBOL res 752 -144 R0
SYMATTR InstName R13
SYMATTR Value 3.32k
SYMBOL res 752 -352 R0
SYMATTR InstName R14
SYMATTR Value 16.6k
TEXT -1488 -1968 Left 2 !.lib switching.lib
TEXT -1488 -1992 Left 2 !.tran 0 {Tend} {Tskip} 10ns startup uic
TEXT -1488 -1944 Left 2 !.options reltol 0.0005
TEXT -872 -2128 Center 3 ;3-cell LiPo battery model
TEXT -1048 -1888 Left 2 ;9.6-12.6. nominal 11.1
TEXT -1480 -2272 Left 2 !.param t1=1m t2=2m Tend=3m
TEXT -984 -2376 Left 2 !.param Vref1_5V=0.834 Vref1_20V=5
TEXT -384 -2376 Left 2 !.param Vref2_5V=0.001 Vref2_20V=5
TEXT -1000 -2440 Left 3 ;Control signals from the system power management microcontroller (up to two 0-5V analog signals)
TEXT -360 -2120 Left 3 ;USB bus model
TEXT -1480 -2184 Left 2 !.param Ts=2.5u
TEXT 168 -2368 Left 2 !******* define times for steady-state operation and transient\n* OP1 steady state interval, 10 switching periods \n.meas start_5V param {t1-Tskip-10*Ts}\n.meas end_5V param {t1-Tskip}\n* OP2x steady state interval, 10 switching periods\n.meas start_20V param {Tend-Tskip-11*Ts}\n.meas end_20V param {Tend-Tskip-Ts}\n* step-load transient to OP2 \n.meas start_load_transient param {t2-Tskip}\n.meas end_load_transient {Tend-Tskip-Ts}\n****** dc bus voltages at operating points 1 and 2\n.meas Vout_5V avg v(out) from start_5V to end_5V\n.meas Vout_20V avg v(out) from start_20V to end_20V\n****** battery and bus voltage ripples at operating point 2\n.meas Vin_ripple_20V pp v(in) from start_20V to end_20V\n.meas Vout_ripple_20V pp v(out) from start_20V to end_20V\n ****** efficiency at operating point 2\n.meas Pin_20V avg -v(in)*i(Vbatt) from start_20V to end_20V\n.meas Pout_20V avg v(out)*i(Rload) from start_20V to end_20V\n.meas eff_20V param 100*Pout_20V/Pin_20V\n****** minimum voltage after step load transient at t2\n.meas Vout_20_min min v(out) from start_load_transient to end_load_transient
TEXT -1168 -2376 Right 2 ;Adjust these time parameters so that:\nAt t1 the converter is in steady state at OP1: 5V output\nAt t2 the converter is in steady state at 20V output, 2.25A\nStep load transient occurs at t2\nAt Tend the converter  is in steady state at OP2: 20V output. 3A
TEXT -1504 -2208 Left 2 ;Define switching period(s) Ts here
TEXT 184 -2432 Left 3 ;Measurement commands
TEXT -1544 -2016 Left 2 ;Simulation commands (no need to change these)
TEXT -984 -2400 Left 2 ;Define Vcontrol1 control levels for the 3 operating model
TEXT -384 -2400 Left 2 ;Define Vcontrol2 control levels for the 3 operating model
TEXT -1552 -2440 Left 3 ;Simulation commands and parameters
TEXT -608 -2136 Center 1 ;Power Electronics Specialization\nUniversity of Colorado Boulder
TEXT 168 -2392 Left 2 ;Do not change the measurement commands
TEXT -1488 -1920 Left 2 !.param Tskip=0.5m
